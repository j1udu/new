<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>泠鸢购物车</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: #eef2f5;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #333;
        }

        .controls {
            text-align: center;
            margin-bottom: 20px;
        }

        button {
            background: linear-gradient(45deg, #4CAF50, #43A047);
            color: #fff;
            border: none;
            padding: 12px 20px;
            margin: 0 8px 12px;
            border-radius: 24px;
            cursor: pointer;
            font-size: 14px;
            transition: transform 0.2s;
        }

        button:hover {
            transform: scale(1.05);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th,
        td {
            padding: 12px;
            text-align: center;
        }

        th {
            background: #fafafa;
            color: #555;
        }

        tr {
            background: #fff;
            transition: background 0.2s;
        }

        tr:hover {
            background: #f1f8e9;
        }

        img.product-img,
        img.cart-img {
            border-radius: 6px;
            width: 60px;
            height: 60px;
            object-fit: cover;
        }

        .section {
            margin-top: 40px;
        }

        .cart-controls {
            text-align: right;
            margin-bottom: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: #fff;
            padding: 24px;
            border-radius: 10px;
            width: 400px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            position: relative;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            margin-bottom: 16px;
        }

        .modal-body {
            overflow-y: auto;
            flex: 1;
            margin-bottom: 16px;
            padding-right: 8px; /* 为滚动条留出空间 */
        }

        .modal-footer {
            text-align: right;
            padding-top: 12px;
            border-top: 1px solid #eee;
        }

        .modal-content h3 {
            margin-top: 0;
        }

        .modal-content .close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
        }

        .modal-content label {
            display: flex;
            margin: 8px 0;
            align-items: center;
        }

        .modal-content .label-text {
            flex: 1;
            margin-right: 16px; /* 为输入框留出空间 */
        }

        .modal-content input[type="text"],
        .modal-content input[type="number"] {
            padding: 8px;
            margin-top: 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 80px; /* 固定输入框宽度 */
        }

        .modal-content input[type="file"] {
            width: 100%;
            padding: 8px;
            margin-top: 4px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        #addImagePreview {
            display: block;
            max-width: 100px;
            margin: 10px auto;
        }

        /* 购物车样式调整 */
        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .cart-title {
            font-size: 24px;
            font-weight: bold;
        }

        .cart-total {
            background: #f8f9fa;
            padding: 12px 16px;
            border-radius: 8px;
            font-weight: bold;
            display: flex;
            align-items: center;
        }

        .cart-total-text {
            margin-right: 8px;
        }

        .cart-total-amount {
            font-size: 28px;
            color: #4CAF50;
        }

        /* 购物车商品网格 */
        #cartItemsGrid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .cart-item {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px;
            display: flex;
            align-items: center;
            transition: transform 0.2s;
        }

        .cart-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .cart-item-img {
            width: 60px;
            height: 60px;
            border-radius: 6px;
            margin-right: 12px;
        }

        .cart-item-details {
            flex: 1;
            text-align: left;
        }

        .cart-item-name {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .cart-item-price {
            color: #666;
            margin-bottom: 4px;
        }

        .cart-item-qty {
            display: flex;
            align-items: center;
        }

        .cart-item-qty input {
            width: 50px;
            margin: 0 8px;
            text-align: center;
        }

        /* 购物车数量调整按钮样式 */
        .cart-item-qty .dec-qty,
        .cart-item-qty .inc-qty {
            width: 18px;
            height: 18px;
            padding: 0;
            margin: 0 2px;
            font-size: 10px;
            border-radius: 50%;
            background: #e8e8e8;
            color: #666;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .cart-item-qty .dec-qty:hover,
        .cart-item-qty .inc-qty:hover {
            background: #d5d5d5;
            color: #333;
            transform: scale(1.05);
        }

        .cart-item-subtotal {
            font-weight: bold;
            color: #4CAF50;
            margin-left: 12px;
        }

        /* 自定义确认对话框样式 */
        #confirmModal .modal-content {
            width: 350px;
        }

        #confirmModal .modal-body {
            text-align: center;
            padding: 20px 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>泠鸢购物车</h1>
        <div class="controls">
            <button id="btnAddProduct">添加商品</button>
            <button id="btnAddAll">一键加入购物车</button>
            <button id="btnEditOrders">编辑已结算</button>
            <button id="btnClearData">清除数据</button>
        </div>

        <!-- 购物车区域 -->
        <div class="section cart">
            <div class="cart-header">
                <div class="cart-title">购物车</div>
                <div class="cart-total">
                    <span class="cart-total-text">总金额：</span>
                    <span class="cart-total-amount">¥<span id="totalAmount">0.00</span></span>
                </div>
            </div>
            
            <div id="cartItemsGrid"></div>
            
            <div class="cart-controls">
                <button id="btnClearCart">清空购物车</button>
                <button id="btnCheckout">结算购物车</button>
            </div>
        </div>

        <!-- 商品列表 -->
        <div class="section product-list">
            <h2>商品列表</h2>
            <table id="productsTable">
                <thead>
                    <tr>
                        <th>图片</th>
                        <th>名称</th>
                        <th>价格</th>
                        <th>数量</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="section orders">
            <h2>已结算商品</h2>
            <table id="ordersTable">
                <thead>
                    <tr>
                        <th>名称</th>
                        <th>数量</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <!-- 添加商品 弹窗 -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <button class="close" id="closeProductModal">×</button>
            <h3>添加商品</h3>
            <label>商品名称：<input type="text" id="prodName" placeholder="输入名称"></label>
            <label>价格 (¥)：<input type="number" id="prodPrice" step="0.01" placeholder="输入价格"></label>
            <label>选择图片 (可选)：<input type="file" id="prodImageFile" accept="image/*"></label>
            <img id="addImagePreview" style="display:none;" />
            <div style="text-align:right; margin-top:10px;">
                <button id="confirmAdd">确认</button>
                <button id="cancelAdd">取消</button>
            </div>
        </div>
    </div>

    <!-- 删除商品 弹窗 -->
    <div class="modal" id="deleteModal">
        <div class="modal-content">
            <h3>确认删除此商品？</h3>
            <div style="text-align:right; margin-top:10px;">
                <button id="confirmDelete">删除</button>
                <button id="cancelDelete">取消</button>
            </div>
        </div>
    </div>

    <!-- 编辑已结算 弹窗 -->
    <div class="modal" id="ordersModal">
        <div class="modal-content">
            <button class="close" id="closeOrdersModal">×</button>
            <div class="modal-header">
                <h3>编辑已结算商品</h3>
            </div>
            <div class="modal-body" id="ordersEditList"></div>
            <div class="modal-footer">
                <button id="saveOrdersEdit">保存</button>
                <button id="cancelOrdersEdit">取消</button>
            </div>
        </div>
    </div>

    <!-- 自定义确认对话框 -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <h3 id="confirmTitle">确认操作</h3>
            <div class="modal-body" id="confirmMessage">
                您确定要执行此操作吗？
            </div>
            <div class="modal-footer">
                <button id="confirmCancel">取消</button>
                <button id="confirmOK">确认</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            renderProducts();
            renderCart();
            renderOrders();
        });

        const STORAGE_PRODUCTS = 'shopping_products';
        const STORAGE_CART = 'shopping_cart';
        const STORAGE_ORDERS = 'shopping_orders';
        // 初始化商品列表（从提供的商品信息生成）
        let products = [
            { id: 1, name: 'T恤 L', price: 125, img: '' },
            { id: 2, name: 'T恤 2XL', price: 125, img: '' },
            { id: 3, name: 'T恤 4XL', price: 125, img: '' },
            { id: 4, name: '羽织 L', price: 148, img: '' },
            { id: 5, name: '羽织 2XL', price: 148, img: '' },
            { id: 6, name: '应援毛巾', price: 88, img: '' },
            { id: 7, name: '心形徽章套组', price: 45, img: '' },
            { id: 8, name: '流沙亚克力', price: 68, img: '' },
            { id: 9, name: '新双闪Q版吧唧', price: 18, img: '' },
            { id: 10, name: '镭射票根Q版', price: 12, img: '' },
            { id: 11, name: 'NFC挂件A款', price: 48, img: '' },
            { id: 12, name: 'NFC挂件B款', price: 48, img: '' },
            { id: 13, name: 'Q版鼠标垫A款', price: 25, img: '' },
            { id: 14, name: 'Q版鼠标垫B款', price: 25, img: '' },
            { id: 15, name: '荧光棒', price: 75, img: '' },
            { id: 16, name: '纸袋', price: 8, img: '' },
            { id: 17, name: '仿彩胶亚克力', price: 42, img: '' },
            { id: 18, name: '亚克力色纸', price: 38, img: '' },
            { id: 19, name: '亚克力立牌', price: 72, img: '' },
            { id: 20, name: '双闪吧唧立绘', price: 18, img: '' },
            { id: 21, name: '双闪吧唧Q版', price: 18, img: '' },
            { id: 22, name: '镭射票', price: 12, img: '' },
            { id: 23, name: '亚克力挂件', price: 25, img: '' },
            { id: 24, name: '三变光栅', price: 10, img: '' },
            { id: 25, name: '亚克力夹', price: 18, img: '' },
            { id: 26, name: '柠檬透扇', price: 18, img: '' },
            { id: 27, name: '小红鸢打卡棒', price: 25, img: '' }
        ], cart = [], orders = [], deleteTargetId = null;
        let confirmCallback = null;

        function compressImage(file, maxWidth = 800, quality = 0.7) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const img = new Image();
                    img.onload = function () {
                        let width = img.width;
                        let height = img.height;
                        if (width > maxWidth) {
                            height *= maxWidth / width;
                            width = maxWidth;
                        }
                        const canvas = document.createElement('canvas');
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        canvas.toBlob(blob => {
                            const reader = new FileReader();
                            reader.onload = () => resolve(reader.result);
                            reader.onerror = reject;
                            reader.readAsDataURL(blob);
                        }, 'image/jpeg', quality);
                    };
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        function loadData() {
            // 优先从localStorage加载数据，没有则使用初始化数据
            const storedProducts = localStorage.getItem(STORAGE_PRODUCTS);
            const storedCart = localStorage.getItem(STORAGE_CART);
            const storedOrders = localStorage.getItem(STORAGE_ORDERS);
            
            if (storedProducts) products = JSON.parse(storedProducts);
            if (storedCart) cart = JSON.parse(storedCart);
            if (storedOrders) orders = JSON.parse(storedOrders);
        }

        function saveProducts() {
            localStorage.setItem(STORAGE_PRODUCTS, JSON.stringify(products));
        }

        function saveCart() {
            localStorage.setItem(STORAGE_CART, JSON.stringify(cart));
        }

        function saveOrders() {
            localStorage.setItem(STORAGE_ORDERS, JSON.stringify(orders));
        }

        function clearAllData() {
            localStorage.removeItem(STORAGE_PRODUCTS);
            localStorage.removeItem(STORAGE_CART);
            localStorage.removeItem(STORAGE_ORDERS);
            products = [
                { id: 1, name: 'T恤 L', price: 125, img: '' },
                { id: 2, name: 'T恤 2XL', price: 125, img: '' },
                { id: 3, name: 'T恤 4XL', price: 125, img: '' },
                { id: 4, name: '羽织 L', price: 148, img: '' },
                { id: 5, name: '羽织 2XL', price: 148, img: '' },
                { id: 6, name: '应援毛巾', price: 88, img: '' },
                { id: 7, name: '心形徽章套组', price: 45, img: '' },
                { id: 8, name: '流沙亚克力', price: 68, img: '' },
                { id: 9, name: '新双闪Q版吧唧', price: 18, img: '' },
                { id: 10, name: '镭射票根Q版', price: 12, img: '' },
                { id: 11, name: 'NFC挂件A款', price: 48, img: '' },
                { id: 12, name: 'NFC挂件B款', price: 48, img: '' },
                { id: 13, name: 'Q版鼠标垫A款', price: 25, img: '' },
                { id: 14, name: 'Q版鼠标垫B款', price: 25, img: '' },
                { id: 15, name: '荧光棒', price: 75, img: '' },
                { id: 16, name: '纸袋', price: 8, img: '' },
                { id: 17, name: '仿彩胶亚克力', price: 42, img: '' },
                { id: 18, name: '亚克力色纸', price: 38, img: '' },
                { id: 19, name: '亚克力立牌', price: 72, img: '' },
                { id: 20, name: '双闪吧唧立绘', price: 18, img: '' },
                { id: 21, name: '双闪吧唧Q版', price: 18, img: '' },
                { id: 22, name: '镭射票', price: 12, img: '' },
                { id: 23, name: '亚克力挂件', price: 25, img: '' },
                { id: 24, name: '三变光栅', price: 10, img: '' },
                { id: 25, name: '亚克力夹', price: 18, img: '' },
                { id: 26, name: '柠檬透扇', price: 18, img: '' },
                { id: 27, name: '小红鸢打卡棒', price: 25, img: '' }
            ];
            cart = [];
            orders = [];
            renderProducts();
            renderCart();
            renderOrders();
        }

        document.getElementById('btnClearData').onclick = () => {
            showConfirm('确认清除数据', '此操作将清除所有本地数据，是否继续？', () => {
                clearAllData();
            });
        };

        function showConfirm(title, message, callback) {
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            confirmCallback = callback;
            document.getElementById('confirmModal').style.display = 'flex';
        }

        document.getElementById('confirmCancel').onclick = () => {
            document.getElementById('confirmModal').style.display = 'none';
            confirmCallback = null;
        };
        
        document.getElementById('confirmOK').onclick = async () => {
            if (confirmCallback) {
                await confirmCallback();
            }
            document.getElementById('confirmModal').style.display = 'none';
            confirmCallback = null;
        };

        const productModal = document.getElementById('productModal');
        let currentImageData = '';

        document.getElementById('btnAddProduct').onclick = () => {
            productModal.style.display = 'flex';
        };

        document.getElementById('closeProductModal').onclick = closeProductModal;
        document.getElementById('cancelAdd').onclick = closeProductModal;

        document.getElementById('confirmAdd').onclick = function () {
            const name = document.getElementById('prodName').value.trim();
            const price = parseFloat(document.getElementById('prodPrice').value);
            if (!name || isNaN(price)) {
                alert('请输入有效的商品名称和价格');
                return;
            }
            // 生成新ID（确保唯一）
            const newId = Math.max(...products.map(p => p.id), 0) + 1;
            products.push({ id: newId, name, price, img: currentImageData });
            saveProducts();
            renderProducts();
            closeProductModal();
        };

        document.getElementById('prodImageFile').onchange = async function () {
            const file = this.files[0];
            if (file) {
                try {
                    currentImageData = await compressImage(file);
                    document.getElementById('addImagePreview').src = currentImageData;
                    document.getElementById('addImagePreview').style.display = 'block';
                } catch (error) {
                    console.error('图片压缩失败:', error);
                    alert('图片上传失败，请重试');
                    currentImageData = '';
                }
            }
        };

        function closeProductModal() {
            productModal.style.display = 'none';
            document.getElementById('prodName').value = '';
            document.getElementById('prodPrice').value = '';
            document.getElementById('prodImageFile').value = '';
            document.getElementById('addImagePreview').style.display = 'none';
            currentImageData = '';
        }

        const deleteModal = document.getElementById('deleteModal');

        function openDeleteModal(id) {
            deleteTargetId = id;
            deleteModal.style.display = 'flex';
        }

        document.getElementById('cancelDelete').onclick = () => {
            deleteTargetId = null;
            deleteModal.style.display = 'none';
        };

        document.getElementById('confirmDelete').onclick = () => {
            products = products.filter(p => p.id !== deleteTargetId);
            orders = orders.filter(o => o.id !== deleteTargetId);
            saveProducts();
            saveOrders();
            renderProducts();
            renderOrders();
            deleteModal.style.display = 'none';
            deleteTargetId = null;
        };

        function renderProducts() {
            const tbody = document.querySelector('#productsTable tbody');
            tbody.innerHTML = '';
            products.forEach((p) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><img class="product-img" src="${p.img || 'data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=='}"></td>
                    <td>${p.name}</td>
                    <td>¥${p.price.toFixed(2)}</td>
                    <td><input type="number" class="prodQty" data-id="${p.id}" value="1" min="1"></td>
                    <td>
                        <button class="btnAddToCart" data-id="${p.id}">加入购物车</button>
                        <button class="btnDeleteProduct" data-id="${p.id}">删除</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            bindProductEvents();
        }

        function bindProductEvents() {
            document.querySelectorAll('.btnAddToCart').forEach(btn => {
                btn.onclick = function () {
                    const id = +this.dataset.id;
                    const qty = +document.querySelector(`.prodQty[data-id='${id}']`).value;
                    addToCart(id, qty);
                };
            });
            document.querySelectorAll('.btnDeleteProduct').forEach(btn => {
                btn.onclick = function () { openDeleteModal(+this.dataset.id); };
            });
            document.getElementById('btnAddAll').onclick = () => {
                document.querySelectorAll('.prodQty').forEach(inp => addToCart(+inp.dataset.id, +inp.value));
            };
            document.getElementById('btnClearCart').onclick = () => {
                cart = [];
                saveCart();
                renderCart();
            };
            document.getElementById('btnCheckout').onclick = () => {
                showConfirm('确认结算', '确认结算购物车吗？', checkoutCart);
            };
            document.getElementById('btnEditOrders').onclick = openOrdersModal;
        }

        function addToCart(id, qty) {
            const prod = products.find(p => p.id === id);
            const exist = cart.find(i => i.id === id);
            if (exist) {
                exist.qty += qty;
            } else {
                cart.push({ ...prod, qty });
            }
            saveCart();
            renderCart();
        }

        function renderCart() {
            const cartGrid = document.getElementById('cartItemsGrid');
            cartGrid.innerHTML = '';
            let total = 0;
            const sortedCart = [...cart].sort((a, b) => {
                const indexA = products.findIndex(p => p.id === a.id);
                const indexB = products.findIndex(p => p.id === b.id);
                return indexA - indexB;
            });
            sortedCart.forEach(item => {
                const sub = item.price * item.qty;
                total += sub;
                const itemElement = document.createElement('div');
                itemElement.className = 'cart-item';
                itemElement.innerHTML = `
                    <img class="cart-item-img" src="${item.img || 'data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=='}">
                    <div class="cart-item-details">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">单价: ¥${item.price.toFixed(2)}</div>
                        <div class="cart-item-qty">
                            <button class="dec-qty" data-id="${item.id}">-</button>
                            <input type="number" class="cartQty" data-id="${item.id}" value="${item.qty}" min="1">
                            <button class="inc-qty" data-id="${item.id}">+</button>
                        </div>
                    </div>
                    <div class="cart-item-subtotal">¥${sub.toFixed(2)}</div>
                    <button class="btnRemove" data-id="${item.id}">×</button>
                `;
                cartGrid.appendChild(itemElement);
            });
            document.getElementById('totalAmount').textContent = total.toFixed(2);
            bindCartModify();
        }

        function bindCartModify() {
            document.querySelectorAll('.btnRemove').forEach(btn => {
                btn.onclick = function () {
                    cart = cart.filter(i => i.id !== +this.dataset.id);
                    saveCart();
                    renderCart();
                };
            });
            document.querySelectorAll('.cartQty').forEach(inp => {
                inp.onchange = function () {
                    const item = cart.find(i => i.id === +this.dataset.id);
                    if (item) {
                        item.qty = Math.max(1, +this.value);
                        saveCart();
                        renderCart();
                    }
                };
            });
            document.querySelectorAll('.inc-qty').forEach(btn => {
                btn.onclick = function () {
                    const item = cart.find(i => i.id === +this.dataset.id);
                    if (item) { item.qty++; saveCart(); renderCart(); }
                };
            });
            document.querySelectorAll('.dec-qty').forEach(btn => {
                btn.onclick = function () {
                    const item = cart.find(i => i.id === +this.dataset.id);
                    if (item && item.qty > 1) { item.qty--; saveCart(); renderCart(); }
                };
            });
        }
        
        function checkoutCart() {
            if (cart.length === 0) {
                console.log("购物车为空，无需结算。");
                return;
            }
            
            // 直接结算，不保存到文件
            cart.forEach(item => {
                const exist = orders.find(o => o.id === item.id);
                if (exist) {
                    exist.qty += item.qty;
                } else {
                    orders.push({ id: item.id, name: item.name, qty: item.qty });
                }
            });
            saveOrders(); // 更新已结算列表
            cart = []; // 清空购物车
            saveCart(); // 保存空购物车到 localStorage
            renderCart(); // 刷新界面
            renderOrders(); // 刷新界面
        }

        function renderOrders() {
            const tbody = document.querySelector('#ordersTable tbody');
            tbody.innerHTML = '';
            products.forEach(p => {
                const o = orders.find(x => x.id === p.id);
                const qty = o ? o.qty : 0;
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${p.name}</td><td>${qty}</td>`;
                tbody.appendChild(tr);
            });
        }

        function openOrdersModal() {
            const listDiv = document.getElementById('ordersEditList');
            listDiv.innerHTML = '';
            products.forEach(p => {
                const o = orders.find(x => x.id === p.id);
                const qty = o ? o.qty : 0;
                const div = document.createElement('div');
                div.style.margin = '6px 0';
                div.innerHTML = `
                    <label class="flex items-center">
                        <span class="flex-1 mr-4">${p.name}：</span>
                        <input type="number" data-id="${p.id}" value="${qty}" min="0" class="w-20">
                    </label>
                `;
                listDiv.appendChild(div);
            });
            ordersModal.style.display = 'flex';
        }

        document.getElementById('saveOrdersEdit').onclick = function () {
            document.querySelectorAll('#ordersEditList input').forEach(inp => {
                const id = +inp.dataset.id;
                const qty = +inp.value;
                const o = orders.find(x => x.id === id);
                if (qty > 0) {
                    if (o) {
                        o.qty = qty;
                    } else {
                        orders.push({ id, name: products.find(p => p.id === id).name, qty });
                    }
                } else {
                    orders = orders.filter(x => x.id !== id);
                }
            });
            saveOrders();
            renderOrders();
            ordersModal.style.display = 'none';
        };

        document.getElementById('cancelOrdersEdit').onclick = () => {
            ordersModal.style.display = 'none';
        };
        document.getElementById('closeOrdersModal').onclick = () => {
            ordersModal.style.display = 'none';
        };

        loadData();
        renderProducts();
        renderCart();
        renderOrders();
    </script>
</body>

</html>